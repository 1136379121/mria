# 功能点需求描述文档 - 页面框架（主框架页）

## 1. 功能基本信息

### 1.1 功能名称
页面框架（主框架页）

### 1.2 所属模块
系统框架 / 导航与权限

### 1.3 优先级
P0-核心

### 1.4 创建日期
2026-01-20

### 1.5 最后更新日期
2026-01-20

---

## 2. 功能概述

### 2.1 功能描述
- 提供系统统一的**主框架页面**：顶部系统级菜单栏 + 左侧菜单栏 + 右侧内容区域。
- 顶部菜单栏按当前用户权限渲染可用模块：默认包含“流程管理”，可选“数据管理 / 远程控制 / 用户管理”。
- 左侧菜单栏从“菜单管理”配置中读取菜单树（两层：父级/子级），并按“启用状态 + 当前用户已授权”过滤后展示。
- 右侧内容区使用 `iframe` 承载具体业务页面（保证页面样式与脚本正常运行）。
- 支持退出登录：清除本地登录信息并返回登录页。

### 2.2 业务背景
系统功能模块较多，需要统一的页面框架承载导航与权限控制，确保用户在一个入口内完成模块切换，同时保证菜单配置可动态生效。

### 2.3 目标用户
- **主要用户**: 所有已登录用户
- **次要用户**: 超级管理员（除使用外，还会配置菜单管理数据，影响左侧菜单渲染）

### 2.4 业务价值
- 统一系统入口与导航体验，减少页面割裂。
- 权限驱动的菜单渲染，避免越权入口暴露。
- 菜单配置动态化：左侧菜单可由菜单管理配置驱动扩展。

---

## 3. 用户故事

### 3.1 用户故事描述
**作为** 已登录用户  
**我希望** 在页面框架中通过菜单快速进入可访问的功能页面  
**以便** 在一个统一入口完成日常业务操作

### 3.2 用户场景

#### 场景1：登录后进入页面并看到可用模块
- **前置条件**: 用户已登录（本地存在 `token`）
- **操作步骤**:
  1. 打开页面框架页
  2. 系统读取用户信息与权限
  3. 渲染顶部菜单栏与左侧菜单
- **预期结果**: 顶部仅展示用户可访问模块；左侧仅展示启用且授权的菜单项；右侧加载默认页面

#### 场景2：点击顶部模块切换
- **前置条件**: 用户已登录且拥有对应模块权限
- **操作步骤**:
  1. 点击顶部某模块（如“数据管理”）
  2. 左侧菜单刷新为该模块对应菜单（或按配置渲染）
  3. 右侧内容区加载该模块默认页面
- **预期结果**: 左侧与右侧内容随模块切换更新

#### 场景3：点击左侧菜单进入页面
- **前置条件**: 左侧存在可点击的子菜单（如“菜单管理”）
- **操作步骤**:
  1. 点击左侧菜单项
  2. 右侧 `iframe` 加载对应页面 URL
- **预期结果**: 右侧展示目标页面内容；左侧高亮当前菜单项

#### 场景4：退出登录
- **前置条件**: 用户已登录
- **操作步骤**:
  1. 点击“退出登录”
  2. 确认退出
- **预期结果**: 清除本地登录信息并跳转到登录页

---

## 4. 功能详细说明

### 4.1 功能特性列表
- [x] 顶部系统级菜单栏（按权限渲染）
- [x] 左侧菜单栏（从菜单管理配置读取、按启用+授权过滤、支持两层）
- [x] 内容区容器（`iframe` 加载业务页面）
- [x] 默认页面加载
- [x] 退出登录

### 4.2 核心功能点

#### 4.2.1 顶部系统级菜单渲染（按权限）
**描述**: 顶部渲染系统模块入口。  
**触发条件**: 页面加载 / 用户信息变化。  
**处理逻辑**:
- 顶部菜单配置为固定集合（示例）：流程管理 / 数据管理 / 远程控制 / 用户管理
- 每个模块配置允许权限列表（任一匹配即可显示）
- 点击模块时：
  - 更新顶部 active 状态
  - 刷新左侧菜单
  - 加载模块默认页面到右侧内容区
**输出结果**: 顶部仅展示用户可访问模块。

#### 4.2.2 左侧菜单渲染（读取菜单管理配置 + 启用/授权过滤）
**描述**: 左侧菜单从菜单管理保存的菜单树中读取并渲染。  
**触发条件**: 页面加载 / 顶部模块切换 / 菜单配置变更后刷新。  
**处理逻辑**:
- 从 `localStorage` 读取菜单树：`menuManagement.menuTree`
- 过滤规则：显示《菜单管理》列表中，所有启用状态的菜单项目。
- 渲染逻辑：
  - 父级按分组标题展示（父级无 `url` 时仅做分组）
  - 子级存在 `url` 时渲染为可点击菜单项
  - 点击父级别可展开和收起子菜单。
  - 父子级的文字大小一致，子菜单有明显缩进，父级菜单字体加粗
  - 默认选中并加载“第一个可见菜单”
**输出结果**: 左侧只显示“启用”的菜单项。

#### 4.2.3 内容区加载（iframe）
**描述**: 右侧内容区承载业务页面。  
**触发条件**: 默认加载 / 点击顶部模块 / 点击左侧菜单。  
**处理逻辑**:
- 使用 `iframe#contentFrame`
- 将 `iframe.src` 设置为目标页面 URL
- 内容页面与框架的边距为10px，圆角为0
**输出结果**: 业务页面完整加载（含 CSS/JS）。

#### 4.2.4 登录校验与跳转
**描述**: 未登录用户不可访问页面框架。  
**触发条件**: 页面加载。  
**处理逻辑**:
- 若本地不存在 `token`：跳转 `登录页原型.html`
- 若不存在 `userInfo`：创建默认用户信息（原型演示用）
**输出结果**: 未登录用户被引导到登录页。

#### 4.2.5 退出登录
**描述**: 退出后清理登录态并返回登录页。  
**触发条件**: 点击“退出登录”。  
**处理逻辑**:
- 弹窗确认
- 清除 `token/refreshToken/userInfo/userId/username`
- 跳转 `登录页原型.html`
**输出结果**: 用户退出并返回登录页。

### 4.3 边界条件
- **正常情况**: 菜单树存在且用户具备至少一个可见菜单，默认加载第一个可见菜单页面
- **异常情况**:
  - `menuManagement.menuTree` 不存在或解析失败：左侧可能为空；内容区置空白页
  - 用户无任何可见菜单：左侧为空；右侧加载 `about:blank`
  - 目标页面不存在：iframe 加载失败（浏览器自身提示）
- **边界情况**:
  - 父级菜单有 `url` 且子级也存在：均可渲染为可点击项（按配置决定）

### 4.4 业务规则
1. 顶部模块按权限显示；无权限模块不展示。
2. 左侧菜单按“启用”过滤展示。
3. 默认加载：优先加载左侧第一个可见菜单；若无可见菜单则内容区空白。
4. 未登录（无 token）必须跳转登录页。

---

## 5. 业务流程

### 5.1 主流程
```
流程步骤：
1. 用户访问页面框架页
2. 校验 token（无则跳登录页）
3. 获取 userInfo（无则原型默认生成）
4. 渲染顶部菜单（按权限）
5. 渲染左侧菜单（读取菜单树并按启用+授权过滤）
6. 默认加载第一个可见菜单到内容区 iframe
```

### 5.2 异常流程
- 菜单树缺失/无权限：左侧不显示菜单，内容区为空白页

---

## 6. 界面设计需求

### 6.1 页面/界面列表
- **页面框架页**:
  - 路径: `/`（原型文件：`原型/页面框架.html`）
  - 说明: 顶部模块导航 + 左侧菜单 + 内容区容器

### 6.2 界面元素

#### 6.2.1 顶部系统级菜单栏
- **类型**: 横向菜单 + 用户信息 + 退出按钮
- **位置**: 页面顶部
- **功能**: 切换模块；显示当前用户；退出登录
- **交互**: 点击菜单切换模块；点击退出弹窗确认

#### 6.2.2 左侧菜单栏
- **类型**: 分组标题 + 菜单项列表
- **位置**: 页面左侧
- **功能**: 展示启用且授权的菜单；点击进入页面
- **交互**: 点击菜单项加载 iframe；当前项高亮

#### 6.2.3 内容区容器
- **类型**: iframe
- **位置**: 页面右侧
- **功能**: 承载业务页面
- **交互**: 随菜单切换刷新内容

### 6.3 交互设计
- 顶部模块高亮当前 active
- 左侧菜单高亮当前 active
- 默认进入时自动加载可见菜单（第一个）

### 6.4 响应式要求
- **桌面端**: 左侧固定 240px，内容区自适应
- **移动端**: 原型暂未实现折叠菜单（可后续补充）

### 6.5 设计参考
- UI 图：`UI图/医院logo.png`（顶部左侧 logo）

---

## 7. 数据需求

### 7.1 输入数据
| 字段名称 | 类型 | 必填 | 格式要求 | 说明 |
|---------|------|------|---------|------|
| token | String | 是 | - | 登录 token（本地存储） |
| userInfo | Object | 是 | JSON | 用户信息（含权限） |
| menuManagement.menuTree | Object[] | 否 | JSON Array | 菜单管理保存的两层菜单树 |

### 7.2 输出数据
| 字段名称 | 类型 | 说明 |
|---------|------|------|
| topMenus | Array | 顶部可见模块列表 |
| sideMenus | Array | 左侧可见菜单列表（启用+授权过滤后） |
| contentFrame.src | String | 当前加载页面 URL |

### 7.3 数据验证规则
- `menuManagement.menuTree` 必须为可解析 JSON 数组，否则视为无配置
- 菜单项 `enabled === false` 不渲染
- 菜单项 `permissions` 未匹配则不渲染

### 7.4 数据存储
- localStorage：
  - `token`
  - `refreshToken`
  - `userInfo`
  - `menuManagement.menuTree`

---

## 10. 安全要求

### 10.1 权限控制
- **访问权限**: 仅登录用户可访问（以 token 校验）
- **操作权限**: 菜单显示与页面访问入口按 `permissions` 控制

---

## 16. 变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|---------|
| v1.0 | 2026-01-20 | Cursor | 根据 `原型/页面框架.html` 整理为需求文档 |

---

**文档结束**

