# 功能点需求描述文档 - 菜单管理

## 1. 功能基本信息

### 1.1 功能名称
菜单管理

### 1.2 所属模块
流程管理配置模块

### 1.3 优先级
P1-高

### 1.4 创建日期
2026-01-20

### 1.5 最后更新日期
2026-01-20

---

## 2. 功能概述

### 2.1 功能描述
- 提供系统菜单的配置入口，支持配置**菜单布局模式**（竖向/横向），并对所有用户界面生效。
- 支持在一级目录下**新增子菜单**，并联动角色权限配置同步更新菜单项。
- 支持对部分模块菜单及自定义菜单进行**编辑、删除、顺序调整**。
- 支持在导航菜单显示**待办数量标识**（与数据权限相关，按规则展示与刷新）。

### 2.2 业务背景
系统菜单包含内置流程节点页面与配置页面。为适配不同医院使用习惯，需要提供统一的菜单配置能力，并将配置结果对全体用户生效。

### 2.3 目标用户
- **主要用户**: 超级管理员（菜单配置者）
- **次要用户**: 其他登录用户（仅受配置影响使用菜单，不可配置）

### 2.4 业务价值
- 降低系统部署与本地化配置成本（布局与菜单结构可配置）。
- 提升导航效率（菜单顺序可调整、子菜单可扩展）。
- 配置与权限一致性（菜单变更自动同步角色授权配置）。

---

## 3. 用户故事

### 3.1 用户故事描述
**作为** 超级管理员  
**我希望** 在菜单管理页面配置菜单布局、维护菜单项与顺序  
**以便** 让系统导航结构符合医院实际业务流程且对所有用户生效

### 3.2 用户场景

#### 场景1：配置菜单布局模式
- **前置条件**: 当前用户为超级管理员
- **操作步骤**:
  1. 打开“菜单管理”页面
  2. 选择菜单布局模式：竖向/横向
  3. 保存配置
- **预期结果**: 配置对所有用户界面生效（竖向：左侧；横向：顶部）

#### 场景2：新增一级目录下的子菜单
- **前置条件**: 当前用户为超级管理员；选择了某一级目录
- **操作步骤**:
  1. 点击【新增子菜单】
  2. 填写菜单名称、排序、当前阶段（多选）
  3. 提交保存
- **预期结果**:
  - 提示“当前菜单配置已变动，请重新登录”
  - 重新登录后新增菜单在导航栏生效
  - 角色授权配置中同步新增菜单项，数据权限默认“仅能查看自己所在科室的全部患者”

#### 场景3：编辑菜单（含列项/查询条件配置）
- **前置条件**: 当前用户为超级管理员；选择可编辑的菜单项
- **操作步骤**:
  1. 点击【编辑】
  2. 修改菜单基础信息、列项/查询条件等
  3. 保存
- **预期结果**: 导航栏与角色授权配置中菜单同步修改

#### 场景4：删除自定义菜单
- **前置条件**: 当前用户为超级管理员；选择自定义新增的菜单
- **操作步骤**:
  1. 点击【删除】
  2. 二次确认
- **预期结果**: 菜单从导航栏与角色授权配置中同步删除

---

## 4. 功能详细说明

### 4.1 功能特性列表
- [x] 菜单布局模式配置（竖向/横向）
- [x] 新增子菜单（仅一级目录下）
- [x] 编辑菜单（限定范围：部分模块菜单与自定义菜单）
- [x] 删除菜单（仅自定义菜单）
- [x] 菜单顺序调整（一级/二级）
- [x] 菜单栏待办标识展示与刷新

### 4.2 核心功能点

#### 4.2.1 菜单布局模式配置
**描述**: 配置系统菜单展示形态（竖向/横向）。  
**触发条件**: 超级管理员在菜单管理页面切换并保存。  
**处理逻辑**:
- 出厂默认：竖向布局
- 仅超级管理员可修改
- 修改后对所有用户界面生效
- 竖向：菜单竖向按序排布在页面最左侧
- 横向：菜单横向按序排布在页面最顶部；二级菜单默认隐藏；点击一级目录展开二级菜单；点击其他区域自动收起
**输出结果**: 全局菜单布局模式生效。

#### 4.2.2 新增子菜单
**描述**: 在一级目录下新增子级菜单，并关联流程阶段。  
**触发条件**: 超级管理员点击【新增子菜单】并提交。  
**处理逻辑**:
- 仅支持在一级目录下新增子级菜单
- 菜单名称：最多20字；不支持特殊字符 `\\ / : * ? \" . < > \\|`
- 排序：默认=当前目录下菜单数量+1，可修改
- 当前阶段：来自“流程管理”的全部流程名称及节点名称，支持多选
- 新增成功提示“当前菜单配置已变动，请重新登录”，重新登录后生效
- 角色授权配置同步新增菜单项；数据权限默认“仅能查看自己所在科室的全部患者”
- 新增菜单页面默认具有“导出Excel”功能（页面能力约束）
**输出结果**: 导航菜单新增子菜单；权限配置同步更新。

#### 4.2.3 编辑菜单
**描述**: 编辑指定范围菜单及自定义菜单，并可配置列项/查询条件。  
**触发条件**: 超级管理员在菜单管理页面点击【编辑】。  
**处理逻辑**:
- 编辑范围：仅支持“定位管理 / 勾画管理 / 计划管理 / 复位管理 / 治疗管理”模块菜单 + 自定义新增菜单
- 编辑后导航栏菜单与角色授权配置同步修改
- 可编辑“表格列项/查询条件”的信息项
**输出结果**: 菜单信息与配置更新。

#### 4.2.4 删除菜单
**描述**: 删除自定义新增菜单。  
**触发条件**: 超级管理员点击【删除】并确认。  
**处理逻辑**:
- 仅支持删除自定义新增菜单（内置菜单不可删除）
- 删除成功后角色授权配置同步删除，导航栏同步删除
**输出结果**: 菜单项被移除。

#### 4.2.5 菜单顺序调整
**描述**: 调整一级/二级菜单顺序与层级。  
**触发条件**: 超级管理员执行拖拽/上下移动等操作并保存。  
**处理逻辑**:
- 一级目录：支持同级调整顺序，调整后二级菜单同步移动；若一级菜单为实际页面，可支持设置为二级菜单
- 二级菜单：可调整为一级，也可在原目录内上下移动
**输出结果**: 导航菜单顺序生效。

#### 4.2.6 菜单栏待办标识
**描述**: 在菜单栏展示待办数量，并按规则展示与刷新。  
**触发条件**: 点击任意菜单名称后更新；系统每30s轮询更新。  
**处理逻辑**:
- 数值与当前账号数据权限相关；列表筛选条件不影响数值
- 定位管理：\[CT预约\]显示待预约数量；\[CT排队叫号\]不显示；其他新增子菜单均显示
- 勾画/计划/复位：模块下全部菜单显示
- 治疗管理：\[治疗预约\]显示该菜单下所有机房待预约数量之和；\[排队叫号\]不显示；其他新增子菜单均显示
**输出结果**: 菜单名称旁显示待办数量标识。

### 4.3 边界条件
- **正常情况**: 超级管理员正常保存配置，重新登录后菜单生效
- **异常情况**:
  - 非超级管理员访问菜单管理页面：仅可查看（或提示无权限）
  - 菜单名称包含非法字符：阻止提交并提示“菜单名称不能含有特殊字符”
  - 菜单配置更新后未重新登录：提示需要重新登录才能生效
- **边界情况**:
  - 菜单名称长度=20：允许；>20：不允许
  - 排序值与现有菜单冲突：按排序规则重新排列（具体实现由产品/研发确认）

### 4.4 业务规则
1. **权限规则**：仅超级管理员可修改菜单配置；其他用户只使用配置后的菜单。
2. **新增范围**：仅支持在一级目录下新增子级菜单。
3. **内置菜单限制**：内置菜单不可删除。
4. **生效规则**：菜单配置变更后需重新登录方可在导航栏生效。
5. **同步规则**：新增/编辑/删除菜单时，角色授权配置中的菜单同步新增/修改/删除。
6. **待办标识刷新**：点击菜单后更新；系统每30s自动轮询更新。

---

## 5. 业务流程

### 5.1 主流程
```
流程步骤：
1. 超级管理员进入菜单管理页面
2. 配置布局模式 / 维护菜单（新增/编辑/删除/顺序调整）
3. 保存配置
4. 系统提示“当前菜单配置已变动，请重新登录”
5. 重新登录
6. 全局导航菜单按新配置生效
```

### 5.2 异常流程
- 非超级管理员进入：提示无权限或只读
- 表单校验失败（菜单名称特殊字符/超长）：提示并阻止提交

---

## 6. 界面设计需求

### 6.1 页面/界面列表
- **菜单管理**:
  - 路径: `/menu-management`（原型页面：`原型/菜单管理.html`）
  - 说明: 提供菜单布局与菜单项维护

### 6.2 界面元素

#### 6.2.1 布局模式配置区
- **类型**: 单选（竖向/横向）+ 保存按钮
- **位置**: 页面顶部
- **功能**: 配置全局菜单布局模式
- **交互**: 切换选项后点击保存生效
- **状态**: 非超级管理员禁用

#### 6.2.2 菜单树/菜单表格
- **类型**: 树形列表或表格
- **位置**: 页面主体左/中部
- **功能**: 展示一级/二级菜单结构与排序
- **交互**: 选择菜单项、调整顺序、编辑/删除（按权限）
- **状态**: 内置菜单删除按钮隐藏/禁用
- 内置菜单树：
      患者管理：一级目录        
        患者列表：原型页面：`原型/患者列表.html`
        患者登记：原型页面：无
      定位管理：一级目录
        CT预约：原型页面：无
        CT排队叫号：原型页面：无
      勾画管理：一级目录
      计划管理：一级目录
      复位管理：一级目录
      治疗管理：一级目录
      后装管理：一级目录
      自适应管理：一级目录
      费用管理：一级目录
      数据监测：一级目录
      统计分析：一级目录
      流程管理配置：一级目录
        流程设置：原型页面：无
        表单管理：原型页面：无
        菜单管理：原型页面：无
        任务分配设置：原型页面：无
        机房设置：原型页面：无
        收费项目：原型页面：无
        字典维护：原型页面：无
        病案文档：原型页面：无
      -内置菜单默认启用
   

#### 6.2.3 新增/编辑弹窗
- **类型**: 弹窗表单
- **位置**: 点击新增/编辑触发
- **功能**: 维护菜单名称、排序、当前阶段等
- **交互**: 表单校验、提交、取消
- **状态**: 仅超级管理员可用

### 6.3 交互设计
- **新增成功提示**: toast “当前菜单配置已变动，请重新登录”
- **菜单名称校验**: 输入非法字符时显示表单校验提示“菜单名称不能含有特殊字符”
- **待办标识刷新**: 点击菜单后刷新；每30s轮询刷新

### 6.4 响应式要求
- **桌面端**: 默认使用桌面布局
- **平板端/移动端**: 基础可用（菜单与表格可滚动）

### 6.5 设计参考
- 参考原始文档截图：见 `原始需求文档/菜单管理.md` 的图片链接

---

## 7. 数据需求

### 7.1 输入数据
| 字段名称 | 类型 | 必填 | 格式要求 | 说明 |
|---------|------|------|---------|------|
| layoutMode | String | 是 | `vertical` / `horizontal` | 菜单布局模式 |
| parentMenuId | String | 否 | - | 一级目录ID（新增子菜单时必填） |
| menuName | String | 是 | 1-20字；不含特殊字符 `\\ / : * ? \" . < > \\|` | 菜单名称 |
| sortOrder | Number | 是 | 正整数 | 排序 |
| stages | String[] | 否 | 多选 | 当前阶段（流程名/节点名） |

### 7.2 输出数据
| 字段名称 | 类型 | 说明 |
|---------|------|------|
| menuTree | Object | 菜单树结构（含排序/层级/内置标识/关联阶段等） |
| needRelogin | Boolean | 配置变更后是否需要重新登录（默认 true） |
| roleMenuSyncResult | Object | 角色授权菜单同步结果 |

### 7.3 数据验证规则
- **菜单名称**: 1-20字，且不能包含特殊字符 `\\ / : * ? \" . < > \\|`
- **排序**: 必须为正整数
- **权限**: 非超级管理员不能提交保存

### 7.4 数据存储
- **数据表**: `menu_config`、`role_menu_permission`（示例）
- **存储字段**: 布局模式、菜单结构、排序、关联阶段、内置标识
- **数据关系**: 菜单配置与角色授权菜单存在同步关系

---

## 9. 性能要求

### 9.1 响应时间
- **页面加载时间**: < 2秒
- **保存操作响应时间**: < 1秒（不含重新登录）

---

## 10. 安全要求

### 10.1 权限控制
- **访问权限**: 登录用户可访问（可按产品策略限制）
- **操作权限**: 仅超级管理员可新增/编辑/删除/调整顺序/保存配置

---

## 11. 兼容性要求

### 11.1 浏览器兼容
- Chrome 90+
- Edge 90+

### 11.2 设备兼容
- 桌面端为主

---

## 14. 依赖关系

### 14.1 前置依赖
- **依赖功能**: 用户登录与权限体系、角色授权配置
- **依赖说明**: 菜单配置需判定超级管理员权限；菜单变更需同步角色授权菜单

### 14.2 后续影响
- **影响功能**: 全局导航渲染、各模块菜单访问入口、待办数量统计

---

## 15. 风险与限制

### 15.1 潜在风险
| 风险 | 影响程度 | 可能性 | 应对措施 |
|------|---------|--------|---------|
| 菜单配置变更后与权限不同步 | 高 | 中 | 保存时强制触发角色授权同步；提供同步结果提示/日志 |
| 配置需要重新登录影响体验 | 中 | 高 | 提供明确提示；后续可优化为热更新 |

### 15.2 已知限制
- 当前仅支持在一级目录下新增子菜单
- 内置菜单不可删除

---

## 16. 变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|---------|
| v1.0 | 2026-01-20 | Cursor | 由原始需求文档转化为标准模板需求文档 |

---

**文档结束**
