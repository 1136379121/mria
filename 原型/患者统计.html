<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ‚£è€…ç»Ÿè®¡ - ç»Ÿè®¡åˆ†æ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background:#f5f5f5;
      color:#1f1f1f;
      /* ç”±é¡µé¢æ¡†æ¶ç»Ÿä¸€æ§åˆ¶è¾¹è·ï¼ˆé¿å…ä¸æ¡†æ¶ padding å åŠ ï¼‰ */
      padding:0;
      overflow:hidden;
    }

    :root{
      --primary:#1677ff;
      --border:#f0f0f0;
      --card:#fff;
      --muted:#8c8c8c;
      --shadow: 0 2px 8px rgba(0,0,0,.06);
    }

    .page{
      height: 100vh;
      min-height: 0;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .header{
      background: var(--card);
      box-shadow: var(--shadow);
      border-radius: 0;
      padding: 12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex: 0 0 auto;
    }

    .title{
      font-size: 18px;
      font-weight: 700;
      color:#333;
      display:flex;
      align-items:center;
      gap: 14px;
      min-width: 0;
    }

    .filters{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }
    .filter-label{
      font-size: 13px;
      color:#666;
      margin-right: 4px;
    }
    .select, .input{
      height: 32px;
      border: 1px solid #d9d9d9;
      border-radius: 6px;
      padding: 0 10px;
      font-size: 13px;
      outline:none;
      background:#fff;
      color:#333;
    }
    .select:focus, .input:focus{
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(22,119,255,.18);
    }
    .select{ min-width: 120px; }
    .input{ width: 240px; }
    .tag{
      display:inline-flex;
      align-items:center;
      gap: 4px;
      padding: 0 8px;
      height: 24px;
      background:#e6f4ff;
      color: var(--primary);
      border-radius: 4px;
      font-size: 12px;
    }

    .content{
      flex: 1 1 auto;
      min-height: 0;
      overflow:auto;
      padding: 0 16px 10px 16px;
    }

    .card{
      background: var(--card);
      border-radius: 0;
      box-shadow: var(--shadow);
      overflow:hidden;
      margin-bottom: 10px;
    }

    .card-hd{
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .card-hd strong{
      font-size: 14px;
      color:#333;
    }

    .btn{
      height: 28px;
      padding: 0 10px;
      border-radius: 6px;
      border: 1px solid #d9d9d9;
      background:#fff;
      cursor:pointer;
      font-size: 12px;
      color:#333;
      user-select:none;
      transition: all .15s ease;
    }
    .btn:hover{ border-color: var(--primary); color: var(--primary); }
    .btn.primary{
      background: var(--primary);
      border-color: var(--primary);
      color:#fff;
    }
    .btn.primary:hover{ background:#4096ff; border-color:#4096ff; color:#fff; }

    /* ç—…ç§ç»Ÿè®¡æ ‡é¢˜ */
    .disease-title{
      font-size: 14px;
      font-weight: 700;
      color:#333;
      padding: 6px 0;
      cursor:default;
    }
    /* Tabåˆ‡æ¢ */
    .tabs{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 16px;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
    }
    .tabs-left{
      display:flex;
      align-items:center;
      gap: 16px;
      padding-left: 12px;
    }
    .tabs-right{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .tab{
      font-size: 13px;
      color:#666;
      padding: 6px 0;
      cursor:pointer;
      border-bottom: 2px solid transparent;
      user-select:none;
    }
    .tab.active{
      color: var(--primary);
      border-bottom-color: var(--primary);
      font-weight: 700;
    }
    .tab.static{
      cursor:default;
      color:#333;
    }

    /* ç—…ç§ç»Ÿè®¡åŒºåŸŸ */
    .disease-section{
      padding: 10px 0;
    }
    .disease-filters{
      display:flex;
      align-items:center;
      gap: 10px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .disease-chart{
      min-height: 300px;
      background:#fafafa;
      border-radius: 6px;
      position: relative;
      padding: 20px 40px 40px 60px;
      display:flex;
      flex-direction:column;
    }
    .bar-chart-container{
      flex: 1;
      display:flex;
      align-items:flex-end;
      justify-content:space-around;
      gap: 8px;
      position: relative;
    }
    .bar-group{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 4px;
      flex: 1;
      max-width: 80px;
    }
    .bar-wrapper{
      width: 100%;
      height: 200px;
      position: relative;
      display:flex;
      align-items:flex-end;
      justify-content:center;
    }
    .bar{
      width: 100%;
      border-radius: 2px 2px 0 0;
      position: relative;
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
    }
    .bar-segment{
      width: 100%;
      transition: all .2s ease;
    }
    .bar-value{
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      font-weight: 600;
      color:#333;
      white-space: nowrap;
    }
    .bar-label{
      font-size: 11px;
      color:#666;
      text-align:center;
      margin-top: 4px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      width: 100%;
    }
    .y-axis{
      position: absolute;
      left: 0;
      top: 0;
      bottom: 40px;
      width: 40px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      font-size: 11px;
      color:#999;
      padding-right: 8px;
      text-align:right;
    }
    .chart-legend{
      position:absolute;
      top: 12px;
      right: 12px;
      display:flex;
      gap: 16px;
      font-size: 12px;
    }
    .legend-item{
      display:flex;
      align-items:center;
      gap: 6px;
    }
    .legend-dot{
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }
    .legend-dot.female{ background:#4a7dff; }
    .legend-dot.male{ background:#61d836; }

    /* ä¸‰ä¸ªç¯å½¢å›¾å¡ç‰‡ */
    .donut-cards{
      display:grid;
      grid-template-columns: repeat(3, minmax(240px, 1fr));
      gap: 10px;
      padding: 10px;
    }

    .donut-card{
      background:#fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      min-height: 250px;
    }
    .donut-card-hd{
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .donut-title{
      font-weight: 700;
      font-size: 13px;
      color:#333;
    }
    .donut-body{
      display:grid;
      grid-template-columns: 160px 1fr;
      gap: 10px;
      align-items:center;
      min-height: 0;
    }
    .donut{
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: conic-gradient(#4a7dff 0 240deg, #61d836 240deg 300deg, #ffcf3f 300deg 360deg);
      position: relative;
      margin: 0 auto;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.04);
    }
    .donut::after{
      content:"";
      position:absolute;
      inset: 26px;
      background:#fff;
      border-radius: 50%;
      box-shadow: 0 0 0 1px rgba(0,0,0,.05);
    }
    .donut-center{
      position:absolute;
      inset: 26px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      z-index: 2;
      padding: 10px;
      font-weight: 800;
      color:#333;
      line-height: 1.2;
    }
    .donut-center .total{ font-size: 14px; }
    .donut-center .label{ margin-top: 6px; font-size: 12px; color:#666; font-weight: 600; }

    .donut-legend{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap: 6px;
      font-size: 12px;
      color:#333;
    }
    .donut-legend-item{
      display:grid;
      grid-template-columns: 12px 1fr auto auto;
      gap: 8px;
      align-items:center;
      padding: 4px 6px;
      border-radius: 8px;
      cursor: default;
    }
    .donut-legend-item:hover{
      background:#f5f5f5;
    }
    .dot{
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background:#4a7dff;
    }
    .dot.c2{ background:#61d836; }
    .dot.c3{ background:#ffcf3f; }
    .dot.c4{ background:#ff5a5a; }
    .dot.c5{ background:#5bc5f7; }

    /* åº•éƒ¨ä¸¤ä¸ªå¡ç‰‡ */
    .bottom-cards{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 10px;
    }

    .process-card, .reason-card{
      background:#fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      min-height: 300px;
    }

    .process-donut{
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: conic-gradient(#4a7dff 0 120deg, #61d836 120deg 200deg, #ffcf3f 200deg 260deg, #ff5a5a 260deg 300deg, #5bc5f7 300deg 340deg, #9c27b0 340deg 360deg);
      position: relative;
      margin: 0 auto;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.04);
    }
    .process-donut::after{
      content:"";
      position:absolute;
      inset: 30px;
      background:#fff;
      border-radius: 50%;
      box-shadow: 0 0 0 1px rgba(0,0,0,.05);
    }
    .process-donut-center{
      position:absolute;
      inset: 30px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      z-index: 2;
      font-weight: 800;
      color:#333;
      line-height: 1.2;
    }
    .process-donut-center .total{ font-size: 16px; }
    .process-donut-center .label{ margin-top: 6px; font-size: 12px; color:#666; font-weight: 600; }

    .process-legend{
      max-height: 200px;
      overflow-y: auto;
      display:flex;
      flex-direction:column;
      gap: 4px;
      font-size: 12px;
      color:#333;
    }
    .process-legend-item{
      display:grid;
      grid-template-columns: 12px 1fr auto auto;
      gap: 8px;
      align-items:center;
      padding: 4px 6px;
      border-radius: 8px;
      cursor: default;
    }
    .process-legend-item:hover{
      background:#f5f5f5;
    }

    .reason-table{
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-size: 12px;
    }
    .reason-table th{
      background:#fafafa;
      color:#333;
      font-weight: 700;
      padding: 8px;
      text-align:center;
      border-bottom: 1px solid var(--border);
    }
    .reason-table td{
      padding: 8px;
      text-align:center;
      border-bottom: 1px solid #f5f5f5;
    }
    .reason-table .col-rank{ width: 60px; }
    .reason-table .col-reason{ width: auto; }
    .reason-table .col-pct{ width: 100px; }
    .reason-table .col-count{ width: 80px; }
  </style>
</head>
<body>
  <div class="page">
    <div class="header">
      <div class="title">
        <span>æ‚£è€…ç»Ÿè®¡</span>
      </div>
      <div class="filters">
        <span class="filter-label">æ‚£è€…äººæ•°</span>
        <span style="font-size: 14px; font-weight: 600; color:#333;">30</span>
        <select class="select" id="campusSelect" title="é™¢åŒº">
          <option value="all" selected>å…¨éƒ¨é™¢åŒº</option>
        </select>
        <select class="select" id="deptSelect" title="ç§‘å®¤">
          <option value="all" selected>å…¨éƒ¨ç§‘å®¤</option>
        </select>
        <select class="select" id="patientGroup">
          <option value="all" selected>å…¨éƒ¨æ‚£è€…</option>
        </select>
        <select class="select" id="attendingDoctor">
          <option value="all" selected>å…¨éƒ¨ä¸»è¯ŠåŒ»ç”Ÿ</option>
        </select>
        <select class="select" id="residentDoctor">
          <option value="all" selected>å…¨éƒ¨ä¸»ç®¡åŒ»ç”Ÿ</option>
        </select>
        <select class="select" id="processType">
          <option value="sbrt" selected>SBRTæµç¨‹</option>
        </select>
        <input class="input" id="dateRange" value="2025-07-01 è‡³ 2026-01-31" />
      </div>
    </div>

    <div class="content">
      <!-- ç—…ç§ç»Ÿè®¡å¡ç‰‡ -->
      <div class="card">
        <div class="tabs">
          <div class="tabs-left">
            <div class="disease-title">ç—…ç§ç»Ÿè®¡</div>
            <div class="tab active" id="tabGender">æ€§åˆ«</div>
            <div class="tab" id="tabAge">å¹´é¾„</div>
            <div class="tab" id="tabSurgery">ä¹³è…ºæ‰‹æœ¯æ–¹å¼</div>
          </div>
          <div class="tabs-right">
            <select class="select" id="diagnosisFilter" style="height: 28px; font-size: 12px;">
              <option value="all" selected>æŒ‰è¯Šæ–­</option>
            </select>
            <input class="input" id="diagnosisKeyword" placeholder="è¯Šæ–­å…³é”®è¯" style="width: 150px; height: 28px; font-size: 12px;" />
            <button class="btn" id="btnSearch" style="height: 28px; padding: 0 10px; font-size: 12px;">ğŸ”</button>
            <button class="btn" id="btnDetail">æ˜ç»†</button>
            <button class="btn" id="btnDownload">ä¸‹è½½</button>
          </div>
        </div>
        <div class="disease-section">
          <div class="disease-chart">
            <div class="chart-legend">
              <div class="legend-item">
                <span class="legend-dot female"></span>
                <span>å¥³</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot male"></span>
                <span>ç”·</span>
              </div>
            </div>
            <div class="y-axis">
              <span>10</span>
              <span>8</span>
              <span>6</span>
              <span>4</span>
              <span>2</span>
              <span>0</span>
            </div>
            <div class="bar-chart-container" id="barChart"></div>
          </div>
        </div>
      </div>

      <!-- ä¸‰ä¸ªç¯å½¢å›¾å¡ç‰‡ -->
      <div class="card">
        <div class="donut-cards">
          <div class="donut-card">
            <div class="donut-card-hd">
              <div class="donut-title">å¹´é¾„æ®µç»Ÿè®¡</div>
              <div style="display:flex; gap: 6px;">
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">æ˜ç»†</button>
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">ä¸‹è½½</button>
              </div>
            </div>
            <div class="donut-body">
              <div class="donut">
                <div class="donut-center">
                  <div>
                    <div class="total">30</div>
                    <div class="label">æ€»æ•°</div>
                  </div>
                </div>
              </div>
              <div class="donut-legend" id="ageLegend"></div>
            </div>
          </div>

          <div class="donut-card">
            <div class="donut-card-hd">
              <div class="donut-title">æ€§åˆ«ç»Ÿè®¡</div>
              <div style="display:flex; gap: 6px;">
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">æ˜ç»†</button>
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">ä¸‹è½½</button>
              </div>
            </div>
            <div class="donut-body">
              <div class="donut">
                <div class="donut-center">
                  <div>
                    <div class="total">30</div>
                    <div class="label">æ€»æ•°</div>
                  </div>
                </div>
              </div>
              <div class="donut-legend" id="genderLegend"></div>
            </div>
          </div>

          <div class="donut-card">
            <div class="donut-card-hd">
              <div class="donut-title">æ¥æºç»Ÿè®¡</div>
              <div style="display:flex; gap: 6px;">
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">æ˜ç»†</button>
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">ä¸‹è½½</button>
              </div>
            </div>
            <div class="donut-body">
              <div class="donut">
                <div class="donut-center">
                  <div>
                    <div class="total">30</div>
                    <div class="label">æ€»æ•°</div>
                  </div>
                </div>
              </div>
              <div class="donut-legend" id="sourceLegend"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨ä¸¤ä¸ªå¡ç‰‡ -->
      <div class="card">
        <div class="bottom-cards">
          <div class="process-card">
            <div class="donut-card-hd">
              <div class="donut-title">æµç¨‹ç»Ÿè®¡</div>
              <div style="display:flex; gap: 6px;">
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">æ˜ç»†</button>
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">ä¸‹è½½</button>
              </div>
            </div>
            <div style="display:grid; grid-template-columns: 200px 1fr; gap: 16px; align-items:start;">
              <div class="process-donut">
                <div class="process-donut-center">
                  <div>
                    <div class="total">69</div>
                    <div class="label">æ€»æ•°</div>
                  </div>
                </div>
              </div>
              <div class="process-legend" id="processLegend"></div>
            </div>
          </div>

          <div class="reason-card">
            <div class="donut-card-hd">
              <div class="donut-title">æš‚åœåŸå› ç»Ÿè®¡</div>
              <div style="display:flex; gap: 6px;">
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">æ˜ç»†</button>
                <button class="btn" style="height: 24px; padding: 0 8px; font-size: 11px;">ä¸‹è½½</button>
              </div>
            </div>
            <div style="flex: 1; display:flex; align-items:center; justify-content:center;">
              <table class="reason-table">
                <thead>
                  <tr>
                    <th class="col-rank">æ’å</th>
                    <th class="col-reason">åŸå› </th>
                    <th class="col-pct">å æ¯”</th>
                    <th class="col-count">æ¬¡æ•°</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="4" style="color:#999; padding: 40px;">æš‚æ— æ•°æ®</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------
    // é¡¶éƒ¨ç­›é€‰ï¼šé™¢åŒº / ç§‘å®¤ï¼ˆUIéª¨æ¶ï¼‰
    // é»˜è®¤ï¼šå…¨éƒ¨é™¢åŒº / å…¨éƒ¨ç§‘å®¤
    // -----------------------------
    const campusOptions = [
      { id: 'all', name: 'å…¨éƒ¨é™¢åŒº' },
      { id: 'c1', name: 'æœ¬éƒ¨é™¢åŒº' },
      { id: 'c2', name: 'ä¸œé™¢åŒº' }
    ];
    const deptOptions = [
      { id: 'all', campusId: 'all', name: 'å…¨éƒ¨ç§‘å®¤' },
      { id: 'd1', campusId: 'c1', name: 'æ”¾ç–—ç§‘' },
      { id: 'd2', campusId: 'c1', name: 'è‚¿ç˜¤ç§‘' },
      { id: 'd3', campusId: 'c2', name: 'æ”¾ç–—ç§‘' },
      { id: 'd4', campusId: 'c2', name: 'ä»‹å…¥ç§‘' }
    ];

    function $(id){ return document.getElementById(id); }

    function updateDeptOptions(){
      const campusId = $('campusSelect')?.value || 'all';
      const deptSelect = $('deptSelect');
      if (!deptSelect) return;
      const prev = deptSelect.value || 'all';

      const list = deptOptions.filter(d => d.id === 'all' || campusId === 'all' || d.campusId === campusId);
      deptSelect.innerHTML = '';
      list.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d.id;
        opt.textContent = d.name;
        deptSelect.appendChild(opt);
      });

      const stillExists = Array.from(deptSelect.options).some(o => o.value === prev);
      deptSelect.value = stillExists ? prev : 'all';
    }

    function initCampusDeptFilters(){
      const campusSelect = $('campusSelect');
      if (campusSelect) {
        campusSelect.innerHTML = '';
        campusOptions.forEach(c => {
          const opt = document.createElement('option');
          opt.value = c.id;
          opt.textContent = c.name;
          campusSelect.appendChild(opt);
        });
        campusSelect.value = 'all';
      }
      updateDeptOptions();
    }

    // ç—…ç§ç»Ÿè®¡æ•°æ®ï¼ˆæ”¯æŒå¤šç§åˆ†ç±»æ–¹å¼ï¼‰
    const diseaseData = [
      { 
        name: 'é¼»å’½åŸä½ç™Œ', 
        total: 10,
        gender: { male: 9, female: 1 },
        age: { '0-15å²': 0, '15-45å²': 5, '45-60å²': 3, '60-80å²': 1, '80å²ä»¥ä¸Š': 0, 'æœªå½•å…¥': 1 },
        surgery: { 'ä¿ä¹³æ‰‹æœ¯': 2, 'å…¨åˆ‡æ‰‹æœ¯': 6, 'æœªå½•å…¥': 2 }
      },
      { 
        name: 'é¼»å’½ä¸Šå£æ¶...', 
        total: 3,
        gender: { male: 3, female: 0 },
        age: { '0-15å²': 0, '15-45å²': 2, '45-60å²': 1, '60-80å²': 0, '80å²ä»¥ä¸Š': 0, 'æœªå½•å…¥': 0 },
        surgery: { 'ä¿ä¹³æ‰‹æœ¯': 0, 'å…¨åˆ‡æ‰‹æœ¯': 1, 'æœªå½•å…¥': 2 }
      },
      { 
        name: 'å·¦è‚ºä¸Šå¶æ¶...', 
        total: 2,
        gender: { male: 2, female: 0 },
        age: { '0-15å²': 0, '15-45å²': 1, '45-60å²': 1, '60-80å²': 0, '80å²ä»¥ä¸Š': 0, 'æœªå½•å…¥': 0 },
        surgery: { 'ä¿ä¹³æ‰‹æœ¯': 0, 'å…¨åˆ‡æ‰‹æœ¯': 0, 'æœªå½•å…¥': 2 }
      },
      { 
        name: 'ç˜¢ç—•ç–™ç˜©', 
        total: 1,
        gender: { male: 0, female: 1 },
        age: { '0-15å²': 0, '15-45å²': 1, '45-60å²': 0, '60-80å²': 0, '80å²ä»¥ä¸Š': 0, 'æœªå½•å…¥': 0 },
        surgery: { 'ä¿ä¹³æ‰‹æœ¯': 1, 'å…¨åˆ‡æ‰‹æœ¯': 0, 'æœªå½•å…¥': 0 }
      },
      { 
        name: 'é¼»å’½åŸä½ç™Œ...', 
        total: 1,
        gender: { male: 1, female: 0 },
        age: { '0-15å²': 0, '15-45å²': 0, '45-60å²': 1, '60-80å²': 0, '80å²ä»¥ä¸Š': 0, 'æœªå½•å…¥': 0 },
        surgery: { 'ä¿ä¹³æ‰‹æœ¯': 0, 'å…¨åˆ‡æ‰‹æœ¯': 0, 'æœªå½•å…¥': 1 }
      },
      { 
        name: 'è‚ºé—¨æ¶æ€§è‚¿...', 
        total: 1,
        gender: { male: 1, female: 0 },
        age: { '0-15å²': 0, '15-45å²': 0, '45-60å²': 0, '60-80å²': 1, '80å²ä»¥ä¸Š': 0, 'æœªå½•å…¥': 0 },
        surgery: { 'ä¿ä¹³æ‰‹æœ¯': 0, 'å…¨åˆ‡æ‰‹æœ¯': 0, 'æœªå½•å…¥': 1 }
      },
      { 
        name: 'é¼»å’½åŸä½ç™Œ...', 
        total: 1,
        gender: { male: 1, female: 0 },
        age: { '0-15å²': 0, '15-45å²': 0, '45-60å²': 0, '60-80å²': 0, '80å²ä»¥ä¸Š': 1, 'æœªå½•å…¥': 0 },
        surgery: { 'ä¿ä¹³æ‰‹æœ¯': 0, 'å…¨åˆ‡æ‰‹æœ¯': 0, 'æœªå½•å…¥': 1 }
      }
    ];

    // åˆ†ç±»æ–¹å¼é…ç½®
    const categoryConfig = {
      gender: {
        segments: [
          { key: 'female', label: 'å¥³', color: '#4a7dff' },
          { key: 'male', label: 'ç”·', color: '#61d836' }
        ],
        order: ['female', 'male']
      },
      age: {
        segments: [
          { key: '0-15å²', label: '0-15å²', color: '#4a7dff' },
          { key: '15-45å²', label: '15-45å²', color: '#61d836' },
          { key: '45-60å²', label: '45-60å²', color: '#ffcf3f' },
          { key: '60-80å²', label: '60-80å²', color: '#ff5a5a' },
          { key: '80å²ä»¥ä¸Š', label: '80å²ä»¥ä¸Š', color: '#5bc5f7' },
          { key: 'æœªå½•å…¥', label: 'æœªå½•å…¥', color: '#9c27b0' }
        ],
        order: ['0-15å²', '15-45å²', '45-60å²', '60-80å²', '80å²ä»¥ä¸Š', 'æœªå½•å…¥']
      },
      surgery: {
        segments: [
          { key: 'ä¿ä¹³æ‰‹æœ¯', label: 'ä¿ä¹³æ‰‹æœ¯', color: '#4a7dff' },
          { key: 'å…¨åˆ‡æ‰‹æœ¯', label: 'å…¨åˆ‡æ‰‹æœ¯', color: '#61d836' },
          { key: 'æœªå½•å…¥', label: 'æœªå½•å…¥', color: '#ffcf3f' }
        ],
        order: ['ä¿ä¹³æ‰‹æœ¯', 'å…¨åˆ‡æ‰‹æœ¯', 'æœªå½•å…¥']
      }
    };

    // å½“å‰é€‰ä¸­çš„åˆ†ç±»æ–¹å¼
    let currentCategory = 'gender';

    // å¹´é¾„æ®µæ•°æ®
    const ageData = [
      { name: '15-45å²', count: 20, pct: 66.67, dot: 'c1' },
      { name: 'æœªå½•å…¥', count: 6, pct: 20.00, dot: 'c2' },
      { name: '80å²åŠä»¥ä¸Š', count: 4, pct: 13.33, dot: 'c3' }
    ];

    // æ€§åˆ«æ•°æ®
    const genderData = [
      { name: 'ç”·', count: 28, pct: 93.33, dot: 'c1' },
      { name: 'å¥³', count: 1, pct: 3.33, dot: 'c2' },
      { name: '3', count: 1, pct: 3.33, dot: 'c3' }
    ];

    // æ¥æºæ•°æ®
    const sourceData = [
      { name: 'æœªçŸ¥', count: 29, pct: 96.67, dot: 'c1' },
      { name: 'é—¨è¯Š', count: 1, pct: 3.33, dot: 'c2' }
    ];

    // æµç¨‹æ•°æ®
    const processData = [
      { name: 'å¤–ç…§å°„æµç¨‹', count: 23, pct: 33.33, dot: 'c1' },
      { name: 'å¤–ç…§å°„æµç¨‹_1', count: 10, pct: 14.49, dot: 'c2' },
      { name: 'å¤–ç…§å°„æµç¨‹+éšè®¿', count: 9, pct: 13.04, dot: 'c3' },
      { name: 'åè£…æµç¨‹_å­æµç¨‹', count: 7, pct: 10.14, dot: 'c4' },
      { name: 'ARTä¸»æµç¨‹', count: 5, pct: 7.25, dot: 'c5' },
      { name: 'å¤–ç…§å°„æµç¨‹+è®¡...', count: 5, pct: 7.25, dot: 'c1' },
      { name: 'ZZZå¤–ç…§å°„æµç¨‹', count: 5, pct: 7.25, dot: 'c2' },
      { name: 'åè£…æµç¨‹', count: 2, pct: 2.90, dot: 'c3' }
    ];

    function renderBarChart() {
      const container = document.getElementById('barChart');
      if (!container) return;
      container.innerHTML = '';
      
      const maxValue = 10; // Yè½´æœ€å¤§å€¼
      const barHeight = 200; // æŸ±å­æœ€å¤§é«˜åº¦ï¼ˆpxï¼‰
      const config = categoryConfig[currentCategory];
      
      diseaseData.forEach(item => {
        const barGroup = document.createElement('div');
        barGroup.className = 'bar-group';
        
        const barWrapper = document.createElement('div');
        barWrapper.className = 'bar-wrapper';
        
        const bar = document.createElement('div');
        bar.className = 'bar';
        const totalHeight = (item.total / maxValue) * barHeight;
        bar.style.height = totalHeight + 'px';
        
        // æ ¹æ®å½“å‰åˆ†ç±»æ–¹å¼æ¸²æŸ“å †å æ®µ
        const categoryData = item[currentCategory];
        config.order.forEach(key => {
          const value = categoryData[key] || 0;
          if (value > 0) {
            const segment = document.createElement('div');
            segment.className = 'bar-segment';
            segment.style.height = (value / item.total) * 100 + '%';
            const segmentConfig = config.segments.find(s => s.key === key);
            if (segmentConfig) {
              segment.style.backgroundColor = segmentConfig.color;
            }
            bar.appendChild(segment);
          }
        });
        
        // æ•°å€¼æ ‡ç­¾
        const valueLabel = document.createElement('div');
        valueLabel.className = 'bar-value';
        valueLabel.textContent = item.total;
        bar.appendChild(valueLabel);
        
        barWrapper.appendChild(bar);
        barGroup.appendChild(barWrapper);
        
        // ç—…ç§åç§°æ ‡ç­¾
        const nameLabel = document.createElement('div');
        nameLabel.className = 'bar-label';
        nameLabel.textContent = item.name;
        nameLabel.title = item.name;
        barGroup.appendChild(nameLabel);
        
        container.appendChild(barGroup);
      });
    }

    function renderLegend(containerId, data) {
      const el = document.getElementById(containerId);
      if (!el) return;
      el.innerHTML = '';
      data.forEach((it) => {
        const row = document.createElement('div');
        row.className = containerId.includes('process') ? 'process-legend-item' : 'donut-legend-item';
        row.innerHTML = `
          <span class="dot ${it.dot}"></span>
          <span class="name" title="${it.name}" style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${it.name}</span>
          <span class="num" style="color:#555; font-variant-numeric: tabular-nums;">${it.count}</span>
          <span class="pct" style="color:#999; font-variant-numeric: tabular-nums;">${it.pct.toFixed(2)}%</span>
        `;
        el.appendChild(row);
      });
    }

    // åˆå§‹åŒ–
    initCampusDeptFilters();
    updateChartLegend(); // åˆå§‹åŒ–å›¾ä¾‹
    renderBarChart(); // æ¸²æŸ“æŸ±çŠ¶å›¾
    renderLegend('ageLegend', ageData);
    renderLegend('genderLegend', genderData);
    renderLegend('sourceLegend', sourceData);
    renderLegend('processLegend', processData);

    // Tabåˆ‡æ¢
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        // æ ¹æ®Tabåˆ‡æ¢åˆ†ç±»æ–¹å¼
        const tabId = this.id;
        if (tabId === 'tabGender') {
          currentCategory = 'gender';
        } else if (tabId === 'tabAge') {
          currentCategory = 'age';
        } else if (tabId === 'tabSurgery') {
          currentCategory = 'surgery';
        }
        
        // æ›´æ–°å›¾ä¾‹
        updateChartLegend();
        // é‡æ–°æ¸²æŸ“æŸ±çŠ¶å›¾
        renderBarChart();
      });
    });

    // æ›´æ–°å›¾ä¾‹
    function updateChartLegend() {
      const legendContainer = document.querySelector('.chart-legend');
      if (!legendContainer) return;
      
      const config = categoryConfig[currentCategory];
      legendContainer.innerHTML = '';
      
      config.segments.forEach(segment => {
        const legendItem = document.createElement('div');
        legendItem.className = 'legend-item';
        legendItem.innerHTML = `
          <span class="legend-dot" style="background: ${segment.color};"></span>
          <span>${segment.label}</span>
        `;
        legendContainer.appendChild(legendItem);
      });
    }

    // äº‹ä»¶ç›‘å¬
    document.getElementById('btnSearch').addEventListener('click', () => alert('åŸå‹å ä½ï¼šæœç´¢'));
    document.getElementById('btnDetail').addEventListener('click', () => alert('åŸå‹å ä½ï¼šæ˜ç»†'));
    document.getElementById('btnDownload').addEventListener('click', () => alert('åŸå‹å ä½ï¼šä¸‹è½½'));
    document.getElementById('dateRange').addEventListener('click', () => alert('åŸå‹å ä½ï¼šæ—¥æœŸé€‰æ‹©å™¨'));
    $('campusSelect')?.addEventListener('change', () => { updateDeptOptions(); /* åŸå‹å ä½ï¼šè¿™é‡Œå¯è§¦å‘æ•°æ®åˆ·æ–° */ });
  </script>
</body>
</html>
